# Software Engineering

## Angular mit Strapi // Coaching

WSEG / HS24

[Source](https://github.com/digital-sustainability/module-wseg/tree/24/hs/docs/slides/content/07) licensed under [CC-BY-4.0](https://github.com/digital-sustainability/module-wseg/blob/24/hs/LICENSE)

--

1. Rückblick
2. Strapi und JWT
3. Angular mit Strapi 🛠️
4. Ausblick
   - Start **Deliverable 3** 🏃
5. Coaching

---

### Rückblick

- Upstream-Angriff via [xz Utils](https://www.openwall.com/lists/oss-security/2024/03/29/4)
- MentorBot + Checkliste
- REST API Client zum debuggen

---

### Strapi [Users & Permissions](https://docs.strapi.io/dev-docs/plugins/users-permissions)

- Public API
  - Registrieren erlaubt ✅
    (Roles & Permissions > Advanced Settings > Enable sign-ups)
  - z.B. _Public_ Role `find` und `findOne` erlauben
- "Private" API
  - z.B. _Authenticated_ Role `create` erlauben

--

### User authentifizieren

POST an http://localhost:1337/api/auth/local

```
{
	"identifier": "testuser",
	"password": "123456"
}
```

Reply beinhaltet https://de.wikipedia.org/wiki/JSON_Web_Token

Note:
https://strapi.io/blog/a-beginners-guide-to-authentication-and-authorization-in-strapi

--

### Login-Ablauf + private API

![](https://imgur.com/OiNHxS2.png)

---

### JWT im Header

```
> GET /api/inserate?populate=* HTTP/1.1
> Host: localhost:1337
> User-Agent: insomnia/2023.5.8
> Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NywiaWF0IjoxNjk4NjU2MjU5LCJleHAiOjE3MDEyNDgyNTl9.t6clZ6zWkAGHafbVR4dW4pO4BY60jz8L2Ygu9VupgXQ
```

- Bonus: Wie immer das JWT mitschicken?
  - [mit einem HTTPInterceptor in Angular](https://medium.com/@mohsinogen/angular-17-http-interceptors-guide-417e7c8ffada)
  - ... folgt

---

### Hinweis zu [/api/users/me](https://forum.strapi.io/t/users-me-update/15187)

- erlaubt in Strapi v4 kein "Update" via PUT 😬
- das müsste im Backend [selbst implementiert](https://medium.com/@fabian.froeschl/add-updateme-route-to-strapi-4-0s-users-permissons-plugin-fc31798df295) werden...
- .. oder unsicherheitshalber `/api/users/:id` öffnen

---

### GET Parameter "?Populate=\*"

Restaurant Beispiel mit Kategorien (=Relation)
http://localhost:1337/api/categories

https://docs.strapi.io/dev-docs/api/rest/guides/understanding-populate

--

### POST für Create

http://localhost:1337/api/restaurants

Request:

```
{
  "data": {
    "name": "Frittenbude"
  }
}
```

--

### PUT für Update

http://localhost:1337/api/restaurants/2

Request:

```
{
  "data": {
    "category": 2
  }
}
```

---

### HTTP in Angular - [Learning Angular #8](https://youtu.be/5K10oYJ5Y-E)

- 👆🏼 Tutorial verwendet [fetch()](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API) mit `Promise`
- Angular's [HttpClientModule](https://docs.strapi.io/dev-docs/integrations/angular#use-the-angular-http-client) verwendet `Observable`
- Strapi-Examples mit [Axios](https://github.com/axios/axios) JS-Bibliothek

--

### JSON-Reply zu GET:

```
{
	"data": [
		{
			"id": 1,
			"attributes": {
				"name": "zfv Brückenstrasse",
				"description": "Mensa BFH-Wirtschaft",
				"createdAt": "2024-04-18T20:50:21.816Z",
				"updatedAt": "2024-04-18T20:50:32.925Z"
			}
		},
		{
			"id": 2,
...
```

--

### Typescript-Datenmodell (ohne data)

```
interface Restaurant {
  id: number;
  attributes: {
    name: string;
    description: string;
  };
}
```

--

### Angular v17 mit Standalone [(Quelle)](https://dev.to/this-is-angular/how-to-fetch-data-using-the-providehttpclient-in-angular-5h47)

#### app.config.ts

- `provider:` um `, provideHttpClient()` erweitern

### Service erstellen

- `ng g service service/restaurant`
- -> wird RestaurantService heissen..

---

### Ausblick

- #8
  - DevOps Einführung (JB)
  - Cloudbasierte (open source) Software (MT)
- #9 Software Validierung (MT)
  - Zwischenpräsentation 2./3. Mai 👩🏼‍‍🏫
- Auffahrt 📺

--

#### Zwischenpräsentation (max. 7min), anschliessend Feedback

- Rückblick und Ausblick + App-Preview
  - Welche Ziele haben wir uns für das Produkt gesetzt?
  - Bisher erreicht / Anpassungen der Ziele?
  - Grösste Schwierigkeiten?
- Fragen ans Publikum
  - mindestens zwei vorbereitete Fragen um Feedback einzuholen.
    (dazu sind auch Onlinetools einsetzbar)

--

### Vorbereitungsauftrag

- 📘 Kapitel 10.2 "DevOps-Automatisierung"
- kurzes Video über [Gitlab CI/CD](https://www.youtube-nocookie.com/embed/ljth1Q5oJoo)
- Kapitel 5 "Cloudbasierte Software" und 5.2 bis 5.3
- eine "gute Frage" stellen
- ... generell das QA-Forum nutzen!
